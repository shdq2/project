<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Host">

	<select id="selectRoomList" parameterType="HostVO" resultType="HostVO">
		SELECT room_content, room_name, room_code FROM `room` WHERE custom_id=#{custom_id} 
		<if test="room_block != 3">
			AND room_block=#{room_block}
		</if>
		ORDER BY room_date DESC;
	</select>
	
	<select id="selectRoomName" parameterType="int" resultType="HostVO">
		SELECT room_content, room_name FROM `room` WHERE room_code=#{room_code}; 
	</select>

	<update id="updateHostName" parameterType="HostVO">
		UPDATE room SET room_name=#{room_name}, room_content=#{room_content} WHERE room_code=#{room_code};
	</update>
	
	<insert id="insertHostCreate" parameterType="HostVO">
		call room_insert(
			#{room_code, mode=IN,jdbcType=VARCHAR},
			#{create_building_type, mode=IN, jdbcType=VARCHAR},
			#{create_room_type, mode=IN, jdbcType=VARCHAR},
			#{create_basic_member, mode=IN, jdbcType=INTEGER},
			#{custom_id, mode=IN, jdbcType=VARCHAR}
		)
	</insert>
	
	<!-- <insert id="insertHostCreate" parameterType="HostVO">
		INSERT INTO room(room_code, room_building_type, room_type, room_basic_member)
			VALUES(#{room_code},#{create_building_type},#{create_room_type},#{create_basic_member});
			
		INSERT INTO room_option(room_code, ro_date) VALUES(#{room_code}, NOW());
	</insert> -->
	
	<select id="selectLastRoomcode" resultType="int">
		SELECT MAX(room_code) FROM room
	</select>
	
	<insert id="insertHostImg" parameterType="HostVO">
		INSERT INTO room_img(room_img_code, room_code, room_img, room_img_date) VALUES(#{room_img_code}, #{room_code}, #{room_img, jdbcType=BLOB}, NOW());
	</insert>
	
	<select id="selectLastRoomImgcode" resultType="int">
		SELECT MAX(room_img_code) FROM room_img
	</select>
	
	<!-- 사진 뿌리기 위한 list -->
	<select id="selectRoomImgList" parameterType="int" resultType="HostVO">
		SELECT room_img_code, room_code FROM `room_img` WHERE room_code=#{room_code} ORDER BY room_img_date DESC
	</select>
	
	<!-- 사진받아오기 -->
	<resultMap type="HostVO" id="selectRoomImg">
	    <result column ="room_img_code" property="room_img_code" />
	    <result column ="room_img" property="room_img" jdbcType="BLOB" />
    </resultMap>
   
   <select id="selectRoomImg" parameterType="int" resultMap="selectRoomImg">
    	SELECT room_img, room_img_code FROM `room_img` WHERE room_img_code=#{room_img_code}
   </select>
   
   <delete id="deleteRoomImg" parameterType="int">
   		DELETE room_img FROM `room_img` WHERE room_img_code=#{room_img_code}
   </delete>
   
   <select id="selectHostBasic" parameterType="int" resultType="HostVO">
   		SELECT room_code, room_space, room_type, room_building_type, room_bath_number, room_bed_number, room_number FROM room WHERE room_code=#{room_code}
   </select> 
   
   <update id="updateHostBasic" parameterType="HostVO">
    	UPDATE room 
    		SET room_number=#{room_number}, room_bed_number=#{room_bed_number},room_bath_number=#{room_bath_number},
    			room_type=#{room_type},room_building_type=#{room_building_type}, room_space=#{room_space} 
    		WHERE room_code=#{room_code}
   </update>
   
   <update id="updateRoomInOut" parameterType="HostVO">
   		UPDATE room SET room_in=#{room_in}, room_out=#{room_out} WHERE room_code=#{room_code}
   </update>
   
   <insert id="insertRoomAmenity" parameterType="HostchkVO">
   		INSERT INTO room_option(room_code, room_option, ro_plus, ro_special, ro_security, ro_date) VALUES(#{room_code},#{room_option},#{ro_plus},#{ro_special},#{ro_security},NOW())
   </insert>
   
   <update id="updateRoomAmenity" parameterType="HostchkVO">
   		UPDATE room_option SET room_option=#{room_option}, ro_plus=#{ro_plus}, ro_special=#{ro_special}, ro_security=#{ro_security}, ro_date=NOW() WHERE room_code=#{room_code}
   </update>
   
   <select id="selectOptionRoomCode" resultType="int">
   		SELECT MAX(room_code) FROM room_option
   </select>
   
   <select id="selectRoomInOut" parameterType="int" resultType="HostVO">
   		SELECT room_in, room_out FROM `room` WHERE room_code=#{room_code}
   </select>
   
   <select id="selectRoomAmenity" parameterType="int" resultType="HostchkVO">
   		SELECT room_option, ro_plus, ro_special, ro_security FROM `room_option` WHERE room_code=#{room_code}
   </select>
   
   <select id="selectHostPrice" parameterType="int" resultType="HostVO">
   		SELECT room_day, room_min_day, room_max_day, room_price_show, room_month_price, room_basic_deposit, room_basic_member, 
   			room_plus_price_apply, room_plus_price, bank_name, bank_num, bank_depositor, fri_price, sat_price, sun_price  FROM `room` WHERE room_code=#{room_code}
   </select>
   
   <update id="updateHostPrice_MinMax" parameterType="HostVO">
   		UPDATE `room` SET room_min_day=#{room_min_day}, room_max_day=#{room_max_day}, room_price_show=#{room_price_show} WHERE room_code=#{room_code}
   </update>
   
   <update id="updateHostPrice_Basic" parameterType="HostVO">
   		UPDATE `room` SET room_month_price=#{room_month_price}, room_basic_deposit=#{room_basic_deposit}, room_basic_member=#{room_basic_member}, room_plus_price_apply=#{room_plus_price_apply}, room_plus_price=#{room_plus_price} WHERE room_code=#{room_code}
   </update>
   
   <select id="selectLongPricecode" resultType="int">
   		SELECT MAX(price_code) FROM `room_long_price`
   </select>
   
   <insert id="insertLongPrice" parameterType="HostVO">
   		INSERT INTO `room_long_price`(price_code, room_code, busy_month_start, busy_day_start, busy_month_end, busy_day_end) VALUES(#{price_code}, #{room_code}, #{busy_month_start}, #{busy_day_start}, #{busy_month_end}, #{busy_day_end})
   </insert>
   
   <update id="updateLongPrice" parameterType="HostVO">
   		UPDATE `room_long_price` SET busy_month_start=#{busy_month_start}, busy_day_start=#{busy_day_start}, busy_month_end=#{busy_month_end}, busy_day_end=#{busy_day_end}
   </update>
   
   <select id="selectLongPrice" parameterType="int" resultType="HostVO">
   		SELECT price_code, busy_month_start, busy_day_start, busy_month_end, busy_day_end FROM `room_long_price` WHERE room_code=#{room_code}
   </select>
	
	<!-- <delete id="deletePriceDel1" parameterType="int">
		DELETE FROM `room_long_price` WHERE price_code=#{price_code};
		DELETE FROM `room_term_plus` WHERE price_code=#{price_code};
	</delete> --> 
	
	<delete id="deletePriceDel1_1" parameterType="int">
		DELETE FROM `room_term_plus` WHERE price_code=#{price_code}
	</delete> 
	
	<delete id="deletePriceDel1_2" parameterType="int">
		DELETE FROM `room_long_price` WHERE price_code=#{price_code}
	</delete>
	
	<delete id="deletePriceDel2" parameterType="int">
		DELETE FROM `room_term_plus` WHERE rt_code=#{rt_code}
	</delete>
	
	<select id="selectRtCode" resultType="int">
		SELECT MAX(rt_code) FROM `room_term_plus` 
	</select>
	
	<insert id="insertRoomTermPlus" parameterType="HostVO">
		INSERT INTO `room_term_plus`(rt_code, rt_day, rt_price, price_code, rt_date, room_code) VALUES(#{rt_code},#{rt_day},#{rt_price},#{price_code},NOW(),#{room_code})
	</insert>
	
	<select id="selectRoomTermPlus" parameterType="int" resultType="HostVO">
		SELECT rt_code, rt_day, rt_price, price_code FROM `room_term_plus` WHERE price_code=#{price_code}
	</select>
	
	<update id="updateHostPrice_Bank" parameterType="HostVO">
		UPDATE `room` SET bank_name=#{bank_name}, bank_num=#{bank_num}, bank_depositor=#{bank_depositor} WHERE room_code=#{room_code}
	</update>
	
	<update id="updateHostPrice_Weekend" parameterType="HostVO">
		UPDATE `room` SET fri_price=#{fri_price}, sat_price=#{sat_price}, sun_price=#{sun_price} WHERE room_code=#{room_code}
	</update>
	
	<select id="selectLastListImgCode" parameterType="int" resultType="int">
		SELECT MAX(room_img_code) FROM `room_img` WHERE room_code=#{room_code}
	</select>
	
	<!-- room_list 삭제 -->
	<delete id="host_list_del1" parameterType="int">
		DELETE FROM `room_term_plus` WHERE room_code=#{room_code}
	</delete> 
	
	<delete id="host_list_del2" parameterType="int">
		DELETE FROM `room_long_price` WHERE room_code=#{room_code}
	</delete> 
	
	<delete id="host_list_del3" parameterType="int">
		DELETE FROM `room_option` WHERE room_code=#{room_code}
	</delete>
	
	<delete id="host_list_del4" parameterType="int">
		DELETE FROM `room_img` WHERE room_code=#{room_code}
	</delete>  
	
	<delete id="host_list_del5" parameterType="int">
		DELETE FROM `room_addr` WHERE room_code=#{room_code}
	</delete> 
	
	<delete id="host_list_del6" parameterType="int">
		DELETE FROM `room` WHERE room_code=#{room_code}
	</delete> 
	<delete id="host_list_del7" parameterType="int">
		DELETE FROM `room_set_confirm` WHERE room_code=#{room_code}
	</delete>
	<delete id="host_list_del8" parameterType="int">
		DELETE FROM `room_addr` WHERE room_code=#{room_code}
	</delete>  
	
	<insert id="insertRoomSetConfirm" parameterType="int">
		INSERT INTO `room_set_confirm`(room_code, confirm_name,confirm_basic,confirm_location,confirm_amenity,confirm_img,confirm_price,confirm_inout) VALUES(#{room_code},0,0,0,0,0,0,0)
	</insert>
	
	<update id="updateRoomSetConfirm1" parameterType="int">
		UPDATE `room_set_confirm` SET confirm_name=1 WHERE room_code=#{room_code}
	</update>
	<update id="updateRoomSetConfirm2" parameterType="int">
		UPDATE `room_set_confirm` SET confirm_basic=1 WHERE room_code=#{room_code}
	</update>
	<update id="updateRoomSetConfirm3" parameterType="int">
		UPDATE `room_set_confirm` SET confirm_location=1 WHERE room_code=#{room_code}
	</update>
	<update id="updateRoomSetConfirm4" parameterType="int">
		UPDATE `room_set_confirm` SET confirm_amenity=1 WHERE room_code=#{room_code}
	</update>
	<update id="updateRoomSetConfirm5" parameterType="int">
		UPDATE `room_set_confirm` SET confirm_img=1 WHERE room_code=#{room_code}
	</update>
	<update id="updateRoomSetConfirm6" parameterType="int">
		UPDATE `room_set_confirm` SET confirm_price=1 WHERE room_code=#{room_code}
	</update>
	<update id="updateRoomSetConfirm7" parameterType="int">
		UPDATE `room_set_confirm` SET confirm_inout=1 WHERE room_code=#{room_code}
	</update>
	
	<select id="selectRoomSetConfirm" parameterType="int" resultType="HostConfirmVO">
		SELECT confirm_name, confirm_basic, confirm_location, confirm_amenity, confirm_img,confirm_price, confirm_inout FROM `room_set_confirm` WHERE room_code=#{room_code};
	</select>
	
	<update id="updateRoomAddr" parameterType="HostVO">
		UPDATE `room_addr` SET room_addr=#{room_addr}, map_lat=#{map_lat}, map_lng=#{map_lng} WHERE room_code=#{room_code}
	</update>
	
	<select id="selectRoomAddr" parameterType="int" resultType="HostVO">
		SELECT room_addr, map_lat, map_lng FROM `room_addr` WHERE room_code=#{room_code}
	</select>
	
	<update id="updateHostBlock" parameterType="int">
		UPDATE `room` SET room_block=2 WHERE room_code=#{room_code}
	</update>
	
	<select id="selectRoomBlock" parameterType="int" resultType="int">
		SELECT room_block FROM `room` WHERE room_code=#{room_code}
	</select>
	
</mapper>	